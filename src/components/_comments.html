<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="comments.scss">
</head>
<body>
<div class="container">
    <h2 class="comments-title">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</h2>

    <form id="commentForm" class="comment-form">
        <div class="form-group">
            <label for="userName" class="form-label">–í–∞—à–µ –∏–º—è:</label>
            <input
                    type="text"
                    id="userName"
                    name="name"
                    class="form-input"
                    placeholder="–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"
                    required
            >
        </div>

        <div class="form-group">
            <label for="userComment" class="form-label">–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
            <textarea
                    id="userComment"
                    name="comment"
                    class="form-textarea"
                    placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏..."
                    maxlength="500"
                    required
            ></textarea>
            <div id="charCounter" class="char-count">0/500</div>
        </div>

        <button type="submit" class="submit-btn">
            <span class="btn-text">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
        </button>
    </form>

    <section class="comments-section">
        <h3 class="comments-subtitle">üí≠ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
        <div class="comments-list" id="commentsContainer">
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            <div class="no-comments">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –û—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>
        </div>
    </section>
</div>

<script src="comments.js"></script>
</body>
</html>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const form = document.getElementById('commentForm');
        const commentInput = document.getElementById('userComment');
        const charCounter = document.getElementById('charCounter');
        const commentsContainer = document.getElementById('commentsContainer');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadComments();
        updateCharCounter();

        // –°–æ–±—ã—Ç–∏—è
        commentInput.addEventListener('input', updateCharCounter);
        form.addEventListener('submit', handleSubmit);

        // –§—É–Ω–∫—Ü–∏–∏
        function updateCharCounter() {
            const length = commentInput.value.length;
            charCounter.textContent = `${length}/500`;
            charCounter.className = `char-count${length > 450 ? ' warning' : length >= 500 ? ' error' : ''}`;
        }

        function handleSubmit(event) {
            event.preventDefault();

            const formData = new FormData(form);
            const name = formData.get('name').trim();
            const comment = formData.get('comment').trim();

            if (!validateForm(name, comment)) return;

            const newComment = createComment(name, comment);

            saveToStorage(newComment);
            displayComment(newComment);
            resetForm();
            scrollToComment();
        }

        function validateForm(name, comment) {
            if (!comment) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
                commentInput.focus();
                return false;
            }
            return true;
        }

        function createComment(name, text) {
            return {
                id: Date.now(),
                name: name || '–ê–Ω–æ–Ω–∏–º',
                text: text,
                date: formatDate(new Date())
            };
        }

        function formatDate(date) {
            return date.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function saveToStorage(comment) {
            const comments = getCommentsFromStorage();
            comments.unshift(comment);
            localStorage.setItem('eventComments', JSON.stringify(comments));
        }

        function getCommentsFromStorage() {
            return JSON.parse(localStorage.getItem('eventComments') || '[]');
        }

        function loadComments() {
            const comments = getCommentsFromStorage();

            if (comments.length === 0) return;

            commentsContainer.innerHTML = '';
            comments.forEach(displayComment);
        }

        function displayComment(comment) {
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            const noComments = commentsContainer.querySelector('.no-comments');
            if (noComments) noComments.remove();

            const commentElement = createCommentElement(comment);
            commentsContainer.prepend(commentElement);
        }

        function createCommentElement(comment) {
            const div = document.createElement('div');
            div.className = 'comment';
            div.innerHTML = `
            <div class="comment-header">
                <span class="comment-author">${escapeHtml(comment.name)}</span>
                <span class="comment-date">${comment.date}</span>
            </div>
            <div class="comment-text">${escapeHtml(comment.text)}</div>
        `;
            return div;
        }

        function resetForm() {
            form.reset();
            updateCharCounter();
        }

        function scrollToComment() {
            const firstComment = document.querySelector('.comment');
            if (firstComment) {
                firstComment.scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    });
</script>